<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Add Test Functionality</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .test-cont {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
        }
        .trash {
            color: red;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Test Add Test Functionality</h1>
    
    <div class="test-info">
        <div class="row form-row test-cont">
            <div class="col-12 col-md-10 col-lg-11">
                <div class="row form-row">
                    <div class="col-12 col-md-5 col-lg-5">
                        <div class="form-group">
                            <label>Test Name</label>
                            <select class="form-control test-name-select" name="test_name" onchange="updateTestId(this)">
                                <option value="">Select Test</option>
                                <option value="1" data-test-id="1">Blood Test</option>
                                <option value="2" data-test-id="2">Urine Test</option>
                                <option value="3" data-test-id="3">X-Ray</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label>Description</label>
                            <input type="text" name="description" class="form-control">
                        </div>
                    </div>
                    <div class="col-12 col-md-1 col-lg-1">
                        <div class="form-group">
                            <label>ID</label>
                            <input type="number" name="id" class="form-control test-id-input" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-2 col-lg-1">
                <label class="d-md-block d-sm-none d-none">&nbsp;</label>
                <a href="#" class="btn btn-danger trash"><i class="far fa-trash-alt"></i></a>
            </div>
        </div>
    </div>
    
    <div class="add-more">
        <a href="javascript:void(0);" class="add-test">
            <i class="fa fa-plus-circle"></i> Add Test
        </a>
    </div>

    <script>
        // Mock test data
        const testData = [
            {test_id: "1", test_name: "Blood Test"},
            {test_id: "2", test_name: "Urine Test"},
            {test_id: "3", test_name: "X-Ray"},
            {test_id: "4", test_name: "MRI Scan"},
            {test_id: "5", test_name: "CT Scan"}
        ];

        // Test Add More functionality
        $(".test-info").on('click','.trash', function () {
            $(this).closest('.test-cont').remove();
            return false;
        });

        $(".add-test").on('click', function () {  
            
            // Generate test options directly from testData
            var testOptions = '<option value="">Select Test</option>';
            if (typeof testData !== 'undefined' && testData.length > 0) {
                testData.forEach(function(test) {
                    testOptions += '<option value="' + test.test_id + '" data-test-id="' + test.test_id + '">' + test.test_name + '</option>';
                });
            }
            
            var testcontent = '<div class="row form-row test-cont">' +
                '<div class="col-12 col-md-10 col-lg-11">' +
                    '<div class="row form-row">' +
                        '<div class="col-12 col-md-5 col-lg-5">' +
                            '<div class="form-group">' +
                                '<label>Test Name</label>' +
                                '<select class="form-control test-name-select" name="test_name" onchange="updateTestId(this)">' +
                                    testOptions +
                                '</select>' +
                            '</div>' +
                        '</div>' +
                        '<div class="col-12 col-md-6 col-lg-6">' +
                            '<div class="form-group">' +
                                '<label>Description</label>' +
                                '<input type="text" name="description" class="form-control">' +
                            '</div>' +
                        '</div>' +
                        '<div class="col-12 col-md-1 col-lg-1">' +
                            '<div class="form-group">' +
                                '<label>ID</label>' +
                                '<input type="number" name="id" class="form-control test-id-input" readonly>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
                '<div class="col-12 col-md-2 col-lg-1"><label class="d-md-block d-sm-none d-none">&nbsp;</label><a href="#" class="btn btn-danger trash"><i class="far fa-trash-alt"></i></a></div>' +
            '</div>';
            
            $(".test-info").append(testcontent);
            return false;
        });

        // Make updateTestId function globally available
        window.updateTestId = function(selectElement) {
            // Get the selected option
            const selectedOption = selectElement.options[selectElement.selectedIndex];
            // Get the test ID from data attribute
            const testId = selectedOption.getAttribute('data-test-id');
            // Find the closest test container
            const testContainer = selectElement.closest('.test-cont');
            // Find the ID input field within this container
            const idInput = testContainer.querySelector('.test-id-input');
            // Set the value
            if (idInput && testId) {
                idInput.value = testId;
            } else if (idInput) {
                idInput.value = '';
            }
        };
    </script>
</body>
</html>
