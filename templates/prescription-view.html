{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0" />
    <title>HealthStack</title>

    <link type="image/x-icon" href="{% static 'HealthStack-System/images/Normal/favicon.png' %}" rel="icon" />
    <link rel="stylesheet" href="{% static 'HealthStack-System/css/Normal/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'HealthStack-System/plugins/Normal/fontawesome/css/fontawesome.min.css' %}" />
    <link rel="stylesheet" href="{% static 'HealthStack-System/plugins/Normal/fontawesome/css/all.min.css' %}" />
    <link rel="stylesheet" href="{% static 'HealthStack-System/css/Normal/style.css' %}" />

    <style>
        :root {
            --accent-color: #95C270;
            --primary-bg: #f8f9fa;
            --secondary-bg: #fff;
            --text-color: #333;
            --light-text: #6c757d;
            --border-color: #e9ecef;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --border-radius: 12px;
        }

        body {
            background-color: var(--primary-bg);
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--text-color);
        }

        .breadcrumb-bar {
            background: var(--accent-color);
            padding: 1.2rem 1rem;
            box-shadow: 0 3px 8px var(--border-color);
            border-radius: 0 0 12px 12px;
            margin-bottom: 1.5rem;
        }
        .breadcrumb-bar .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #e9f7cf;
            font-size: 0.95rem;
        }
        .breadcrumb-bar .breadcrumb-item a {
            color: #f0f6e9;
            transition: color 0.3s ease;
        }
        .breadcrumb-bar .breadcrumb-item a:hover {
            color: #d1e89b;
            text-decoration: underline;
        }
        .breadcrumb-bar .breadcrumb-item.active {
            color: #e9f7cf;
            cursor: default;
        }
        .breadcrumb-title {
            color: #fff;
            font-weight: 700;
            font-size: 2rem;
            margin: 0;
            letter-spacing: 0.02em;
        }

        .content { padding: 40px 0; }
        .card { border: none; border-radius: var(--border-radius); box-shadow: var(--card-shadow); margin-bottom: 24px; }
        .invoice-content { background-color: var(--secondary-bg); padding: 30px; border-radius: var(--border-radius); box-shadow: var(--card-shadow); }
        .invoice-logo img { max-width: 180px; }
        .invoice-details { text-align: right; color: var(--light-text); line-height: 1.6; }
        .invoice-item { border-bottom: 1px solid var(--border-color); padding-bottom: 20px; margin-bottom: 20px; }
        .invoice-item:last-child { border-bottom: none; padding-bottom: 0; margin-bottom: 0; }
        .invoice-info strong { display: block; margin-bottom: 10px; font-size: 1.1rem; color: var(--accent-color); }
        .invoice-info p b { color: var(--text-color); }
        .invoice-table-wrap { margin-top: 30px; }
        .invoice-table { width: 100%; border-collapse: collapse; border: 1px solid var(--border-color); border-radius: var(--border-radius); overflow: hidden; margin-top: 20px; }
        .invoice-table th, .invoice-table td { padding: 12px 15px; text-align: left; border: 1px solid var(--border-color); font-size: 0.95rem; }
        .invoice-table thead tr th { background-color: var(--accent-color); color: white; font-weight: 600; border-color: var(--accent-color); }
        .invoice-table tbody tr:nth-child(odd) { background-color: #f9f9f9; }
        .invoice-table .text-center { text-align: center; }
        h2 b { color: var(--accent-color); font-size: 1.5rem; font-weight: 600; }

        .btn { padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all 0.3s ease; }
        .btn-primary { background-color: var(--accent-color); border-color: var(--accent-color); color: white; }
        .btn-primary:hover { background-color: #7da559; border-color: #7da559; }
        .btn-info { background-color: #17a2b8; border-color: #17a2b8; color: white; }
        .btn-info:hover { background-color: #117a8b; border-color: #117a8b; }
        .btn a { color: white; text-decoration: none; }
    </style>
</head>

<body>
<div class="main-wrapper">
    <header class="header">{% include 'patient_navbar.html' %}</header>

    <div class="breadcrumb-bar">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-12 col-12">
                    <nav aria-label="breadcrumb" class="page-breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'patient-dashboard' %}">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Patient Dashboard</li>
                        </ol>
                    </nav>
                    <h2 class="breadcrumb-title">Patient Dashboard</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-5 col-lg-4 col-xl-3 theiaStickySidebar">
                    <div>{% include 'patient-sidebar.html' %}</div>
                </div>

                <div class="col-md-7 col-lg-6 col-xl-9">
                    {% for prescription in prescription %}
                    <div class="invoice-content">
                        <div class="invoice-item">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="invoice-logo">
                                        <img src="{% static 'HealthStack-System/images/Normal/logo.png'%}" alt="logo">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <p class="invoice-details">
                                        <strong>Prescription ID:</strong> {{prescription.prescription_id}} <br>
                                        <strong>Patient ID:</strong> {{prescription.patient.patient_id}} <br>
                                        <strong>Date:</strong> {{prescription.create_date}}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="invoice-item">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="invoice-info">
                                        <strong class="customer-text">Doctor Information</strong>
                                        <p class="invoice-details invoice-details-two">
                                            <b>Name: </b>{{prescription.doctor.name}} <br>
                                            <b>Department: </b>{{prescription.doctor.department_name}}<br>
                                            <b>Email: </b>{{prescription.doctor.email}} <br>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="invoice-info invoice-info2">
                                        <strong class="customer-text">Prescription To</strong>
                                        <p class="invoice-details">
                                            <b>Name: </b>{{prescription.patient.name}}<br>
                                            <b>Address: </b>{{prescription.patient.address}}<br>
                                            <b>Email: </b>{{prescription.patient.email}}<br>
                                            <b>Phone Number: </b>{{prescription.patient.phone_number}}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Medicine Table -->
                        <div class="invoice-item invoice-table-wrap">
                            <hr>
                            <h2 class="text-center mb-4"><b>Medicine</b></h2>
                            <hr>
                            <div class="table-responsive">
                                <table class="invoice-table table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Medicine Name</th>
                                            <th class="text-center">Quantity</th>
                                            <th class="text-center">Frequency</th>
                                            <th class="text-center">Duration</th>
                                            <th class="text-center">Relation with meal</th>
                                            <th class="text-center">Instruction</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for pm in prescription_medicine %}
                                        <tr>
                                            <td class="text-center">{{pm.medicine_name}}</td>
                                            <td class="text-center">{{pm.quantity}}</td>
                                            <td class="text-center">{{pm.frequency}}</td>
                                            <td class="text-center">{{pm.duration}}</td>
                                            <td class="text-center">{{pm.relation_with_meal}}</td>
                                            <td class="text-center">{{pm.instruction}}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Test Table -->
                        <div class="invoice-item invoice-table-wrap mt-4">
                            <hr>
                            <h2 class="text-center mb-4"><b>Test</b></h2>
                            <hr>
                            <div class="table-responsive">
                                <table class="invoice-table table table-bordered">
                                    <thead>
                                        <tr style="background-color: #95C270">
                                            <th class="text-center">Test Name</th>
                                            <th class="text-center">Description</th>
                                            <th class="text-center">Test ID</th>
                                            <th class="text-center">Price</th>
                                            <th class="text-center">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for pt in prescription_test %}
                                        <tr>
                                            <td class="text-center">{{pt.test_name}}</td>
                                            <td class="text-center">{{pt.test_description}}</td>
                                            <td class="text-center">{{pt.test_info_id}}</td>
                                            <td class="text-center">{{pt.test_info_price}}</td>
                                            <td class="text-center">
                                                {% if pt.test_info_id and pt.test_info_id.strip %}
                                                <a href="{% url 'test-add-to-cart' prescription.prescription_id pt.test_info_id %}" 
                                                   class="btn btn-sm btn-success">Add to Cart</a>
                                                {% else %}
                                                <span class="text-muted">N/A</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Advice / Recommendation -->
                        <div class="invoice-item invoice-table-wrap mt-4">
                            <div class="table-responsive">
                                <table class="invoice-table table table-bordered">
                                    <thead>
                                        <tr>
                                            <th style="background-color: var(--accent-color); color: white;">
                                                <h2 class="text-center mb-0"><b>Advice/Recommendation</b></h2>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>{{prescription.extra_information}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="mt-3">
                                <a href="{% url 'test-cart' pk=prescription.prescription_id %}" class="btn btn-primary">View Test Cart</a>
                                <a target="_blank" href="{% url 'pres_pdf' pk=prescription.prescription_id %}" class="btn btn-info">Download Prescription</a>
                            </div>
                        </div>

                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'HealthStack-System/js/Normal/jquery.min.js' %}"></script>
<script src="{% static 'HealthStack-System/js/Normal/popper.min.js' %}"></script>
<script src="{% static 'HealthStack-System/js/Normal/bootstrap.min.js' %}"></script>
<script src="{% static 'HealthStack-System/Outside_assets/js/script.js' %}"></script>
</body>
</html>
