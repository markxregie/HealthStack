{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
  <title>HealthStack</title>

  <!-- Favicons -->
  <link type="image/x-icon" href="{% static 'HealthStack-System/images/Normal/favicon.png' %}" rel="icon">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="{% static 'HealthStack-System/css/Normal/bootstrap.min.css' %}">

  <!-- Fontawesome CSS -->
  <link rel="stylesheet" href="{% static 'HealthStack-System/plugins/Normal/fontawesome/css/fontawesome.min.css' %}">
  <link rel="stylesheet" href="{% static 'HealthStack-System/plugins/Normal/fontawesome/css/all.min.css' %}">

  <!-- Main CSS -->
  <link rel="stylesheet" href="{% static 'HealthStack-System/css/Normal/style.css' %}">
  <link rel="stylesheet" href="{% static 'HealthStack-System/css/Normal/hospital.css' %}">
  <link rel="stylesheet" href="{% static 'HealthStack-System/css/Normal/search2.css' %}">
  <link rel="stylesheet" href="{% static 'HealthStack-System/pharmacy_assets/css/icomoon.css'%}">

  <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.min.js"></script>
    <script src="assets/js/respond.min.js"></script>
  <![endif]-->

  <style>
    :root {
      --accent: rgb(149, 194, 112);
    }
    body {
      background: #f9f9f9;
      font-family: 'Segoe UI', sans-serif;
      color: #333;
    }
    .breadcrumb-bar {
      background: var(--accent);
      padding: 15px 20px;
      color: #fff;
      border-radius: 0 0 12px 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .breadcrumb-bar h2.breadcrumb-title {
      color: #fff;
      font-size: 22px;
      font-weight: 600;
      margin-top: 5px;
    }
    .breadcrumb a {
      color: #fff;
      font-weight: 500;
    }
    .card-title {
      font-size: 36px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 20px;
    }
    .cart-list .table {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .cart-list thead {
      background: var(--accent);
      color: #fff;
    }
    .cart-list th {
      font-weight: 600;
      text-transform: uppercase;
      font-size: 13px;
      padding: 12px;
    }
    .cart-list td {
      vertical-align: middle;
      padding: 12px;
      font-size: 14px;
    }
    .product-remove a {
      color: #ff4d4d;
      font-size: 18px;
    }
    .cart-total {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      text-align: center;
    }
    .cart-total h3 {
      font-size: 20px;
      color: var(--accent);
      margin-bottom: 15px;
    }
    .btn-primary {
      background: var(--accent) !important;
      border: none;
      border-radius: 30px;
      font-weight: 600;
      transition: 0.3s;
    }
    .btn-primary:hover {
      background: #95c270d9 !important;
    }
    .btn-info {
      background: #fff !important;
      color: var(--accent) !important;
      border: 2px solid var(--accent);
      border-radius: 30px;
      font-weight: 600;
      transition: 0.3s;
    }
    .btn-info:hover {
      background: var(--accent) !important;
      color: #fff !important;
    }
  </style>
</head>
<body>
  <!-- Main Wrapper -->
  <div class="main-wrapper">
    <!-- Header -->
    <header class="header">
      {% if user.is_authenticated and user.is_patient %}
      {% include 'patient_navbar.html' %}
      {% endif %}

      {% if user.is_authenticated and user.is_doctor %}
      {% include 'doctor-navbar.html' %}
      {% endif %}
    </header>
    <!-- /Header -->

    <!-- Breadcrumb -->
    <div class="breadcrumb-bar">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col-md-6 col-6">
            <nav aria-label="breadcrumb" class="page-breadcrumb">
              <ol class="breadcrumb">
                {% if user.is_authenticated and user.is_patient %}
                <li class="breadcrumb-item"><a href="{% url 'patient-dashboard' %}">Home</a></li>
                {% endif %}
                {% if user.is_authenticated and user.is_doctor %}
                <li class="breadcrumb-item"><a href="{% url 'doctor-dashboard' %}">Home</a></li>
                {% endif %}
                <li class="breadcrumb-item active" aria-current="page">Test Cart</li>
              </ol>
            </nav>
            <h2 class="breadcrumb-title">Test Cart</h2>
          </div>
        </div>
      </div>
    </div>
    <!-- /Breadcrumb -->

    <!-- Page Content -->
    <div class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-5 col-lg-4 col-xl-3 theiaStickySidebar">
            <div>
              {% if user.is_authenticated and user.is_patient %}
              {% include 'patient-sidebar.html' %}
              {% endif %}
              {% if user.is_authenticated and user.is_doctor %}
              {% include 'doctor-sidebar.html' %}
              {% endif %}
            </div>
          </div>

          <div class="col-md-7 col-lg-8 col-xl-9">
            <section class="wrapper">
              <div class="container-fostrap">
                <h1 class="card-title text-center">Test Cart</h1>
                <section class="ftco-section ftco-cart">
                  <div class="container">
                    <div class="row">
                      <div class="col-md-12 ftco-animate">
                        <div class="cart-list">
                          <table class="table">
                            <thead class="thead-primary">
                              <tr class="text-center">
                                <th></th>
                                <th>Test ID</th>
                                <th>Test Name</th>
                                <th>Price</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for test in test_carts %}
<tr class="text-center">
  <td class="product-remove">
    <a href="{% url 'test-remove-cart' test.id %}"><span class="icon-close"></span></a>
  </td>
  <td>{{ test.item.test_info_id }}</td>
  <td>{{ test.item.test_name }}</td>
  <td class="price">{{ test.item.test_info_price }}</td>
</tr>
{% endfor %}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                    <div class="row justify-content-end">
                      <div class="col col-lg-4 col-md-6 mt-5 cart-wrap ftco-animate">
                        <div class="cart-total mb-3">
                          <h3><b>Cart Totals: </b><span>{{ total }} PHP</span></h3>
                          <hr>
                        </div>
                        <p class="text-center">
                          {% if test_order.payment_status|lower != 'paid' and test_order.payment_status|lower != 'failed' %}
                          <a href="{% url 'paymongo-test-payment' prescription_id patient.pk test_order.id %}">
                            <button class="btn btn-primary py-3 px-4">Proceed to Payment</button>
                          </a>
                          {% elif test_order.payment_status|lower == 'paid' %}
                          <button class="btn btn-success py-3 px-4" disabled>Payment Completed</button>
                          {% elif test_order.payment_status|lower == 'failed' %}
                          <a href="{% url 'paymongo-test-payment' prescription_id patient.pk test_order.id %}">
                            <button class="btn btn-warning py-3 px-4">Retry Payment</button>
                          </a>
                          {% else %}
                          <a href="{% url 'paymongo-test-payment' prescription_id patient.pk test_order.id %}">
                            <button class="btn btn-primary py-3 px-4">Proceed to Payment</button>
                          </a>
                          {% endif %}
                        </p>
                        <p class="text-center">
                          <a href="{% url 'prescription-view' pk=prescription_id %}" class="btn btn-info py-3 px-4">Back to Prescription</a>

                        </p>
                      </div>
                    </div>
                  </div>
                </section>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
    <!-- /Page Content -->

    <!-- Footer -->
    {% include 'footer.html' %}
    <!-- /Footer -->
  </div>
  <!-- /Main Wrapper -->

  <!-- jQuery -->
  <script src="{% static 'HealthStack-System/js/Normal/jquery.min.js' %}"></script>
  <!-- Bootstrap Core JS -->
  <script src="{% static 'HealthStack-System/js/Normal/popper.min.js' %}"></script>
  <script src="{% static 'HealthStack-System/js/Normal/bootstrap.min.js' %}"></script>
  <!-- Sticky Sidebar JS -->
  <script src="{% static 'HealthStack-System/plugins/Normal/theia-sticky-sidebar/ResizeSensor.js' %}"></script>
  <script src="{% static 'HealthStack-System/plugins/Normal/theia-sticky-sidebar/theia-sticky-sidebar.js' %}"></script>
  <!-- Custom JS -->
  <script src="{% static 'HealthStack-System/Outside_assets/js/script.js' %}"></script>
  <!-- Searchbar JS -->
  <script src="{% static 'HealthStack-System/js/Normal/sidebar.js' %}"></script>
</body>
</html>
